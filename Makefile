# ===============================================
# メインターゲット
# ===============================================

# デフォルトターゲット (make とだけ打った場合に実行される)
.PHONY: all
all: build

# QMKキーマップのビルドを実行するターゲット
# コンテナが残るように run を使用し、高速な繰り返し実行を実現
.PHONY: build
build:
	docker compose run build
	@echo "✅ ビルドが完了しました。ファイルは tmp/ にあります。"

# ===============================================
# クリーンアップ/環境管理
# ===============================================

# コンテナとネットワークを停止・削除し、環境をクリーンにする
.PHONY: clean
clean:
	@echo "🧹 停止しているコンテナとネットワークをクリーンアップします..."
	docker compose down
	@echo "✅ クリーンアップが完了しました。"

# ビルドされたコンテナのみを削除し、再起動時にコンテナを再構築させる
.PHONY: rm-container
rm-container:
	@echo "❌ ビルドコンテナを削除します..."
	docker compose rm -f build
	@echo "✅ コンテナが削除されました。"

# ===============================================
# ヘルプ
# ===============================================

.PHONY: help
help:
	@echo "--- Keyball QMK ビルド用 Makefile ---"
	@echo "make build       : キーマップをビルドします"
	@echo "make clean       : 停止中のコンテナとネットワークを全て削除します"
	@echo "make rm-container: ビルドコンテナのみを削除します"
